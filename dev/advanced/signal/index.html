<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Signal Decomposition · GeNIOS.jl</title><meta name="title" content="Signal Decomposition · GeNIOS.jl"/><meta property="og:title" content="Signal Decomposition · GeNIOS.jl"/><meta property="twitter:title" content="Signal Decomposition · GeNIOS.jl"/><meta name="description" content="Documentation for GeNIOS.jl."/><meta property="og:description" content="Documentation for GeNIOS.jl."/><meta property="twitter:description" content="Documentation for GeNIOS.jl."/><meta property="og:url" content="https://tjdiamandis.github.io/GeNIOS.jl/advanced/signal/"/><meta property="twitter:url" content="https://tjdiamandis.github.io/GeNIOS.jl/advanced/signal/"/><link rel="canonical" href="https://tjdiamandis.github.io/GeNIOS.jl/advanced/signal/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GeNIOS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/constrained-ls/">Constrained Least Squares</a></li><li><a class="tocitem" href="../../examples/huber/">Huber Fitting</a></li><li><a class="tocitem" href="../../examples/lasso/">Lasso</a></li><li><a class="tocitem" href="../../examples/logistic/">Logistic Regression</a></li><li><a class="tocitem" href="../../examples/portfolio/">Markowitz Portfolio Optimization</a></li></ul></li><li><span class="tocitem">Advanced Usage</span><ul><li><a class="tocitem" href="../lasso/">Lasso, Three Ways</a></li><li><a class="tocitem" href="../portfolio/">Markowitz Portfolio Optimization, Three Ways</a></li><li class="is-active"><a class="tocitem" href>Signal Decomposition</a><ul class="internal"><li><a class="tocitem" href="#Generating-the-problem-data"><span>Generating the problem data</span></a></li><li><a class="tocitem" href="#Defining-the-probelem"><span>Defining the probelem</span></a></li><li><a class="tocitem" href="#Plotting-the-results"><span>Plotting the results</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../guide/">User Guide</a></li><li><a class="tocitem" href="../../method/">Solution method</a></li><li><a class="tocitem" href="../../gpu/">GPU Support</a></li><li><a class="tocitem" href="../../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced Usage</a></li><li class="is-active"><a href>Signal Decomposition</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Signal Decomposition</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/tjdiamandis/GeNIOS.jl/blob/main/examples/advanced/signal.jl#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>The source files for all examples can be found in <a href="https://github.com/tjdiamandis/GeNIOS.jl/tree/main/examples">/examples</a>.</p><h1 id="Signal-Decomposition"><a class="docs-heading-anchor" href="#Signal-Decomposition">Signal Decomposition</a><a id="Signal-Decomposition-1"></a><a class="docs-heading-anchor-permalink" href="#Signal-Decomposition" title="Permalink"></a></h1><p>This example uses the <code>GenericSolver</code> to solve a signal decomposition problem with custom proximal operators. This problem seeks to decompose an observed signal into a sum of several components.</p><pre><code class="language-julia hljs">using GeNIOS
using Random, LinearAlgebra, SparseArrays
using Plots
using ProximalOperators: TotalVariation1D, prox!
using BandedMatrices
using LinearMaps</code></pre><h2 id="Generating-the-problem-data"><a class="docs-heading-anchor" href="#Generating-the-problem-data">Generating the problem data</a><a id="Generating-the-problem-data-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-problem-data" title="Permalink"></a></h2><pre><code class="language-julia hljs">Random.seed!(1)
T, K = 200, 3
t = range(0, 1000, T)

# component 2: sine wave
s2 = @. sin(2π * t * 1/500)

# component 3: square wave
square(x) = x % 2π &lt; π ? 1 : -1
s3 = @. square(2π  * t * 1/450)

# component 1: noise
s1 = 0.1 * randn(T)

# observed signal
X = hcat(s1, s2, s3)
y = sum(X, dims=2) |&gt; vec

sig_plt = plot(
    t,
    y,
    lw=1,
    label=&quot;observed signal&quot;,
    xlabel=&quot;time&quot;,
    ylabel=&quot;signal&quot;,
    legend=:topright,
    dpi=300,
    marker=:circle,
    ls=:dash,
    color=:royalblue
)
plot!(sig_plt,
    t,
    sum(X[:, 2:end], dims=2) |&gt; vec,
    label=&quot;true signal&quot;,
    lw=3,
    color=:royalblue
)</code></pre><img src="e053b275.svg" alt="Example block output"/><h2 id="Defining-the-probelem"><a class="docs-heading-anchor" href="#Defining-the-probelem">Defining the probelem</a><a id="Defining-the-probelem-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-probelem" title="Permalink"></a></h2><p>We will separate the observed signal <span>$y$</span> into a sum of <span>$K=3$</span> signals <span>$x_k$</span>. The first is mean-squared small (noise). The second is second-order smooth (smooth derivative). The third is first-difference sparse (piecewise constant). This problem can be phrased as</p><p class="math-container">\[\begin{array}{ll}
\text{minimize}  &amp; (1/T)\|y - x^2 - x^3\|_2^2 + \gamma_2 \phi_2(x^2) + \gamma_3 \phi_1(x^3),
\end{array}\]</p><p>where</p><p class="math-container">\[\phi_2(x) = \frac{1}{T-2}\sum_{i=2}^{T-1} (x_{t+1} - 2x_t + x_{t-1})^2\]</p><p>and</p><p class="math-container">\[\phi_3(x) = \frac{1}{T-1}\sum_{i=1}^{T-1} \lvert x_{t+1} - x_t \rvert\]</p><p>.</p><p>We will solve this problem using the genertic solver interface, with the first term as <span>$f(x)$</span> and the second and third terms as <span>$g(z)$</span>. Specifically, this problem can be rephrased as</p><p class="math-container">\[\begin{array}{ll}
\text{minimize}  &amp; (1/T)\|x^1\|_2^2 + I_{\{0\}}(z^1) + \gamma_2 \phi_2(z^2) + \gamma_3 \phi_1(z^3) \\
\text{subject to} &amp; x^1 + x^2 + x^3 - z^1 = y \\
&amp;&amp; x^2 - z^2 = 0 \\
&amp;&amp; x^3 - z^3 = 0,
\end{array}\]</p><p>where <span>$I_{\{0\}}(z^1)$</span> is the indicator function for the zeros vector. We note that the proximal operators for the second and third terms can be parallelized.</p><p>First we define <span>$f(x)$</span>, which is just a quadratic.</p><pre><code class="language-julia hljs">params = (; T=T)

f(x, p) = sum(abs2, x[1:p.T] ) / p.T

function grad_f!(g, x, p)
    @. g[1:p.T] = 2/p.T * x[1:p.T]
    g[p.T+1:end] .= zero(eltype(x))
    return nothing
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">grad_f! (generic function with 1 method)</code></pre><p>The <code>HessianOperator</code> here is block diagonal, with a <span>$T \times T$</span> identity block, followed by two zero blocks.</p><pre><code class="language-julia hljs">struct HessianSignal &lt;: HessianOperator end
function LinearAlgebra.mul!(y, ::HessianSignal, x)
    T = length(x) ÷ 3
    @. y[1:T] = 2/T * x[1:T]
    y[T+1:end] .= zero(eltype(x))
    return nothing
end
update!(::HessianSignal, ::Solver) = nothing
Hf = HessianSignal()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.HessianSignal()</code></pre><h3 id="A-custom-proximal-operator"><a class="docs-heading-anchor" href="#A-custom-proximal-operator">A custom proximal operator</a><a id="A-custom-proximal-operator-1"></a><a class="docs-heading-anchor-permalink" href="#A-custom-proximal-operator" title="Permalink"></a></h3><p>Now, we define <span>$g$</span> and its proximal operator. Here, we will take advantage of parallelization, as this problem is clearly separable across components. Further performance improvements could be made for these proximal operators, which we avoid for simplicity.</p><p>We use <code>ProximalOperators.jl</code> to help construct the proximal operator.</p><pre><code class="language-julia hljs">function g(z, p)
    @views z1, z2, z3 = z[1:p.T], z[p.T+1:2p.T], z[2p.T+1:end]
    any(.!iszero.(z1)) &amp;&amp; return Inf

    gz2 = sum(t-&gt;(z2[t+1] - 2z[t] + z[t-1])^2, 2:p.T-1)
    gz3 = sum(abs, diff(z3)) / (p.T-1)
    return gz2 + gz3
end

# the prox operator for g, using ProximalOperators.jl
function prox_g!(v, z, ρ, p)
    @views z1, z2, z3 = z[1:p.T], z[p.T+1:2p.T], z[2p.T+1:end]
    @views v1, v2, v3 = v[1:p.T], v[p.T+1:2p.T], v[2p.T+1:end]

    Threads.@threads for k in 1:3
        if k == 1
            # Prox for z1
            v1 .= zero(eltype(z))
        elseif k == 2
            # Prox for z2
            # g²(z²) = γ₂/T * ||Az||²
            du = vcat(zeros(1), ones(p.T-2))
            d = vcat(zeros(1), -2*ones(p.T-2), zeros(1))
            dl = vcat(ones(p.T-2), zeros(1))

            # Use banded matrix for O(T) solve time
            A = BandedMatrix(-1 =&gt; dl, 0 =&gt; d, 1 =&gt; du)
            F = cholesky(I + 1e3/(ρ * p.T) * A&#39;*A)
            ldiv!(v2, F, z2)
        else
            # Prox for z3
            ϕ³ = TotalVariation1D(1/p.T)
            prox!(v3, ϕ³, z3, 1/ρ)
        end
    end

    return nothing
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">prox_g! (generic function with 1 method)</code></pre><h3 id="The-constraints"><a class="docs-heading-anchor" href="#The-constraints">The constraints</a><a id="The-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#The-constraints" title="Permalink"></a></h3><p>Note that <span>$M$</span> is a highly structured matrix. We use <code>LinearMaps.jl</code> to implement this more efficiently.</p><pre><code class="language-julia hljs">_0 = LinearMap(spzeros(T, T))
M = [
        I  I  I;
        _0  I  _0;
        _0  _0  I
]
c = vcat(y, zeros(T), zeros(T));</code></pre><h3 id="Solving-the-problem"><a class="docs-heading-anchor" href="#Solving-the-problem">Solving the problem</a><a id="Solving-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-problem" title="Permalink"></a></h3><pre><code class="language-julia hljs">solver = GeNIOS.GenericSolver(
    f, grad_f!, Hf,         # f(x)
    g, prox_g!,             # g(z)
    M, c;                   # M, c: Mx + z = c
    params=params
)
res = solve!(solver, options=GeNIOS.SolverOptions(eps_abs=1e-5, print_iter=100))

x1 = solver.xk[1:T]
x2 = solver.xk[T+1:2T]
x3 = solver.xk[2T+1:end];</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Starting setup...
Setup in  0.330s

──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    Iteration        Obj Val       r_primal         r_dual              ρ           Time
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            0      0.000e+00            Inf            Inf      1.000e+00         0.000
            1      0.000e+00      2.146e+01      3.716e+01      1.000e+00         2.702
          100      1.034e+02      5.062e-04      8.941e-03      5.000e-01         2.998
          200      1.070e+02      4.418e-04      1.876e-03      1.250e-01         3.169
          300      1.078e+02      3.830e-04      1.075e-03      1.250e-01         3.327
          400      1.072e+02      1.604e-04      6.493e-04      1.250e-01         3.486
          500      1.079e+02      1.081e-04      4.436e-04      1.250e-01         3.644
          585      1.088e+02      8.961e-05      2.570e-04      1.250e-01         3.779

SOLVED in  3.779s, 585 iterations
Total time:  4.109s
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre><h2 id="Plotting-the-results"><a class="docs-heading-anchor" href="#Plotting-the-results">Plotting the results</a><a id="Plotting-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-results" title="Permalink"></a></h2><pre><code class="language-julia hljs">res_plt = plot(
    t,
    y,
    lw=1,
    label=&quot;observed signal&quot;,
    xlabel=&quot;time&quot;,
    ylabel=&quot;signal&quot;,
    legend=:topright,
    dpi=300,
    marker=:circle,
    ls=:dash
)
plot!(res_plt,
    t,
    sum(X[:, 2:end], dims=2) |&gt; vec,
    label=&quot;true signal&quot;,
    lw=3,
    color=:blue
)
plot!(res_plt,
    t,
    x2 + x3,
    label=&quot;reconstructed signal&quot;,
    lw=3,
    color=:coral1
)</code></pre><img src="4c4debde.svg" alt="Example block output"/><h3 id="Visualizing-each-component"><a class="docs-heading-anchor" href="#Visualizing-each-component">Visualizing each component</a><a id="Visualizing-each-component-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-each-component" title="Permalink"></a></h3><pre><code class="language-julia hljs">p1 = plot(
    t,
    X[:, 1],
    lw=1,
    label=&quot;x1 true&quot;,
    xlabel=&quot;time&quot;,
    ylabel=&quot;signal&quot;,
    legend=:topright,
    dpi=300,
    marker=:circle,
    ls=:dash,
    color=:royalblue
)
plot!(p1,
    t,
    x1,
    label=&quot;x1 estimated&quot;,
    lw=3,
    color=:coral1
)

p2 = plot(
    t,
    X[:, 2],
    lw=3,
    label=&quot;x2 true&quot;,
    xlabel=&quot;time&quot;,
    ylabel=&quot;signal&quot;,
    legend=:topright,
    dpi=300,
    ls=:dash,
    color=:royalblue
)
plot!(p2,
    t,
    x2,
    label=&quot;x2 estimated&quot;,
    lw=3,
    color=:coral1
)

p3 = plot(
    t,
    X[:, 3],
    lw=3,
    label=&quot;x3 true&quot;,
    xlabel=&quot;time&quot;,
    ylabel=&quot;signal&quot;,
    legend=:topright,
    dpi=300,
    ls=:dash,
    color=:royalblue
)
plot!(p3,
    t,
    x3,
    label=&quot;x3 estimated&quot;,
    lw=3,
    color=:coral1
)
decomp_plt = plot(p1, p2, p3, layout=(3,1))</code></pre><img src="2c1f602c.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../portfolio/">« Markowitz Portfolio Optimization, Three Ways</a><a class="docs-footer-nextpage" href="../../guide/">User Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Monday 26 May 2025 18:05">Monday 26 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
